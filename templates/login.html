<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="google-signin-clientid" content="19264160664-vr8ip7ef18ls54n7jmk4s16s156ngl10.apps.googleusercontent.com">
    <title></title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
    </script>
    <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
    </script>
  </head>
  <body>
    <div id="signinButton">
      <span class="g-signin2"
        data-scope="openid email"
        data-redirecturi="postmessage"
        data-accesstype="offline"
        data-cookiepolicy="single_host_origin"
        data-onsuccess="onSignIn"
        data-onfailure="onSignInFailure"
        data-approvalprompt="force">
      </span>

    </div>
    <div id="result"></div>

    <script>
      function onSignIn(googleUser) {
        var authResponse = googleUser.getAuthResponse(true);
        var code = authResponse.id_token;
        if (code){
          //Hide the signin button now that the user is authorized
          $('#signinButton').attr('style','display: none');

          //Send the one-time-use code to the server, if the server responds, write
          $.ajax({
            type: 'POST',
            url: '/gconnect?state={{STATE}}',
            processData: false,
            data: code,
            contentType: 'application/octet-stream; charset=utf-8',
            success: function(result){
              //Handle or verify the server response if necessary
              if (result){
                $('#result').html('Login Successful!</br>' + result + '</br>Redirecting...')
                setTimeout(function(){
                  window.location.href = "/restaurant";
                }, 4000)
              }
            }
          })
        }
    }
      function onSignInFailure() {
        console.log('There was an error: ' + authResult['error']);
    }

    </script>

  </body>
</html>
